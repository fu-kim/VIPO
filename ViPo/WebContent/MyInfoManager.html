<!DOCTYPE html>
<html>
<head>

	<title>帐户管理</title>
	<link rel="stylesheet" type="text/css" href="me_files/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="me_files/infostyle.css">
<style type="text/css">
	.oploadImg{
			cursor: pointer;
    		display: inline-block;
    		border: 1px solid #d3d3d3;
    		height: 25px;
    		line-height: 25px;
    		text-align: center;
    		vertical-align: top;
    		margin-top: 30px;
    		margin-left: 20px;
    		border-radius: 3px;
    		padding: 5px 15px;
    		color: #7f7f7f;
		}
		.fileBtn{
			display: none;
		}
		
</style>
</head>

<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
<script type="text/javascript">
function loadmyinfo(){
	$.ajax({
		  url:'logined',
			 method:'get',
			 success:function(result){
				 if(result.code==200){
					 $('#username').text(result.data.u_name);
					 $('#myuserName').val(result.data.u_name);
					 $('#userohone').text(result.data.u_phone);
					 $('#integral').text(result.data.u_integral);
					 $('#uphone').text(result.data.u_phone);
					 $('#mailboxid').text(result.data.u_phone);
					 
					 //判断邮箱是否存在
					 if(result.data.u_mailbox==null){
						 $('#mailbox').text("设置");
						 $('#mailbox').attr("class","btn_s btn_style2 buttonInline");
						 $('#mailbox').attr("data-target","#exampleModa7");
					 }else{
						 $('#mailbox').text("修改");
						 $('#mailbox').attr("class","btn_s btn_style buttonInline");
						 $('#mailbox').attr("data-target","#exampleModa2");
					 }
					 //头像是否存在
					 if(result.data.u_head!=null){
						 var image = result.data.u_head
						 var src = "http://127.0.0.1:8089/myface/"+image;
						 $('#headimages').attr("src",src);
						 $('#headimage').attr("src",src);
						 $('#load').val('');
						 
					 }else{
						 $('#headimages').attr("src","http://127.0.0.1:8089/myface/default.jpg");
						 $('#headimage').attr("src","http://127.0.0.1:8089/myface/default.jpg");
					 }
					 
					//生日是否存在
					 if(result.data.u_birthday!=null){
						 $('#birthday').val(result.data.u_birthday);
					 }else{
						 $('#birthday').val("2000-00-00");
						
					 }
					
					//性别是否存在
					 if(result.data.u_birthday!=null){
						 $('#sex').val(result.data.u_sex);
					 }else{
						 $('#sex').val("男");
						
					 }
					 
				 }else{
			  	 	 location.href="login.html";
				 }
					
			 }
	  })
}
loadmyinfo();
</script>

<body>
	<div class="container">
		<div class="header">
			<div class="row">
				<div class="col-md-12" style="margin-right: 27px; float: left; font-family: MyriadPro-Regular;line-height: 78px;font-size: 16px;">
					<a href="service.html" class="aheader">VIPO 官网</a>
					<a href="javascript:;" class="aheader">ColorOS</a>
					<a href="javascript:;" class="aheader">云服务</a>
					<a href="javascript:;" class="a_out aheader">退出</a>
					<div class="header_language">
						<span class="icdown" id="isture">简体中文 ▼</span>
						<div class="changeBox" id="list">
							<div>简体中文</div>
							<div>繁体中文</div>
							<div>English</div>
						</div>
					</div>
					<a href="javascript:;" class="help aheader">帮助中心</a>
				</div>
			</div>
		</div>
		<div class="box">
			<div class="box_header boxSmall">
				<div class="row">
					<div class="col-md-12">
						<div class="profile_userInfo">
							<div class="userInfo">
								<img id="headimages" class="userImg">
								<div class="userInfo_name" id="username">
									
								</div>
								<div class="userInfo_phone" id="userohone">
									
								</div>
								<div class="integral integralMobil">
									<span class="integral_num" id="integral"></span>
									积分
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="box">
			<div class="row">
				<div class="col-md-12">
						<div class="box_content">
							<div class="content">
								<div class="item">
									<div class="item_info">
									<br>
									<img src="http://127.0.0.1:8089/ViPofile/images/zhaq.png" style="position: absolute;left: 0;top: 28px;">
										<p class="item_title">账号密码</p>
										<p class="item_name"></p>
										<p class="item_submit">用于保护账号安全</p>
									</div>
									<button type="button" class="btn_s btn_style buttonInline" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap">修改</button>
								</div>
								<div class="item" style="top: 80px;">
									<div class="item_info">
										<br>
									<img src="http://127.0.0.1:8089/ViPofile/images/aqsj.png" style="position: absolute;left: 0;top: 28px;">
										<p class="item_title">安全手机</p>
										<p class="item_name"></p>
										<p class="item_submit">安全手机可用于登录 VIPO 帐号，重置密码或其他安全验证</p>
									</div>
									<button type="button" class="btn_s btn_style buttonInline" data-toggle="modal" data-target="#exampleModa6" data-whatever="@getbootstrap">修改</button>
								</div>
								
								<div class="item" style="top: 160px;">
									<div class="item_info">
										<br>
									<img src="http://127.0.0.1:8089/ViPofile/images/emaq.png" style="position: absolute;left: 0;top: 28px;">
										<p class="item_title">安全邮箱</p>
										<p class="item_name"></p>
										<p class="item_submit">安全邮箱可用于登录VIPO 帐号，重置密码或其他安全验证</p>
									</div>
									<button id="mailbox" type="button" data-toggle="modal" data-target="#exampleModa2" data-whatever="@getbootstrap">修改</button>
								</div>
								<div class="item" style="top: 240px;">
									<div class="item_info">
									<br>
									<img src="http://127.0.0.1:8089/ViPofile/images/myinfo.png"style="position: absolute;left: 0;top: 28px;">
										<p class="item_title">我的信息</p>
										<p class="item_name"></p>
										<p class="item_submit">管理修改您的账号信息</p>
									</div>
									<button type="button" class="btn_s btn_style buttonInline" data-toggle="modal" data-target="#exampleModa4" data-whatever="@getbootstrap">查看</button>
								</div>
								<div class="item" style="top: 320px;">
									<div class="item_info">
									<br>
									<img src="http://127.0.0.1:8089/ViPofile/images/sqgl.png" style="position: absolute;left: 0;top: 28px;">
										<p class="item_title">授权管理</p>
										<p class="item_name"></p>
										<p class="item_submit">可以查看并管理您的VIPO账号的授权管理</p>
									</div>
									<button type="button" class="btn_s btn_style buttonInline" data-toggle="modal" data-target="#exampleModa5" data-whatever="@getbootstrap">查看</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="footer">
				<p>
				<span>© 2005 - 2019 VIPO 版权所有 粤ICP备14056724号-2</span>
				<span>联系方式：4001-666-888</span>
				</p>
			</div>
	</div>
<script src="js/jquery-1.12.4.min.js"></script>
<script type="text/javascript">
	function updatepwd(){
		var addressinfo=$("#pwd").serialize();
		$.ajax({
			url:'updatepwd',
			method:'post',
			data:addressinfo,
			success:function(result){
				if(result.code==200){
  					$("#exampleModal").modal('hide');
  				 }else if(result.code==402){
  					alert("旧密码错误");
				}else{
  					alert(result.message);
 			  	 	 location.href="login.html";
				}
			}
		})
	}
	
	function updatemailbox(){
		var maliboxinfo=$("#maliboxs").serialize();
		alert(maliboxinfo);
		$.ajax({
			url:'updatemailbox',
			method:'post',
			data:maliboxinfo,
			success:function(result){
				if(result.code==200){
  					$("#exampleModa6").modal('hide');
  				 }else{
  					alert(result.message);
 			  	 	 location.href="login.html";
				}
			}
		})
	}
	function updateNewmailbox(){
		var maliboxinfo=$("#maliboxs2").serialize();
		
		$.ajax({
			url:'updatemailboxCode',
			method:'post',
			data:maliboxinfo,
			success:function(result){
				if(result.code==200){
					$("#addcodetxt").html(
							'<span>点击发送短信认证按钮，将发送一条含有数字验证码的短信</span>'+
  		          			'<br>'+
  		          			'<span>至您的手机</span> <span style="color: #2AD181" id="mailboxid"></span>'+
  		          			'<span>,用于验证身份</span>' 
		  			);
					$("#send").val("发送信息");
					$('#mailboxid').text(result.data.u_phone);
  					$("#exampleModa2").modal('hide');
  				 }else{
  					alert(result.message);
 			  	 	 
				}
			}
		})
	}
	function Authentication(){
		var phone = $("#mailboxid").text();
		$.ajax({
			url:'Authentication?phone='+phone,
			method:'get',
			success:function(result){
				if(result.code==200){
					
  					$("#addcodetxt").html(
  							'<span>已发送，注意查收！</span><br>'+
	  						'新邮箱：<input name="mailbox" type="text" class="form-control" placeholder="请输入新的邮箱" style="width: 220px;height: 45px;">'+
	  						'验证码：<input name="codeInfo" type="text" class="form-control" placeholder="请输入验证码" style="width: 220px;height: 45px;">'
  					);
  					$("#send").val("确定修改");
  					$('#send').attr("onclick","updateNewmailbox()");
  				 }else{
  					alert(result.message);
				}
			}
		})
	}
	
	function myinfo(){
		var formdata=new FormData($('#myinfo')[0]);
		$.ajax({
			url:'myupload',
			method:'post',
			data:formdata,
			processData:false,
			contentType:false,
			success:function(result){
				if(result.code==200){
					loadmyinfo();
					$("#exampleModa4").modal('hide');
  				 }else{
  					alert(result.message);
				}
			}
		})
	}
	
	function updateNewPhone(){
		var phoneinfo=$("#maliboxs3").serialize();
		
		$.ajax({
			url:'updatePhoneCode',
			method:'post',
			data:phoneinfo,
			success:function(result){
				if(result.code==200){
					$("#phonecode").html(
							'<span>点击发送短信认证按钮，将发送一条含有数字验证码的短信</span>'+
  		          			'<br>'+
  		          			'<span>至您的手机</span> <span style="color: #2AD181" id="mailboxid"></span>'+
  		          			'<span>,用于验证身份</span>' 
		  			);
					$("#send2").val("发送信息");
					$('#uphone').text(result.data.u_phone);
  					$("#exampleModa6").modal('hide');
  					loadmyinfo();
  				 }else{
  					alert(result.message);
  					$("#phonecode").html(
							'<span>点击发送短信认证按钮，将发送一条含有数字验证码的短信</span>'+
  		          			'<br>'+
  		          			'<span>至您的手机</span> <span style="color: #2AD181" id="mailboxid"></span>'+
  		          			'<span>,用于验证身份</span>' 
		  			);
					$("#send2").val("发送信息");
					$('#uphone').text(result.data.u_phone);
				}
			}
		})
	}
	function AuthenticationPhone(){
		var phone = $("#uphone").text();
		$.ajax({
			url:'Authentication?phone='+phone,
			method:'get',
			success:function(result){
				if(result.code==200){
					
  					$("#phonecode").html(
  							'<span>已发送，注意查收！</span><br>'+
	  						'新手机号：<input name="phone" type="text" class="form-control" placeholder="请输入新的手机号" style="width: 220px;height: 45px;">'+
	  						'验证码：<input name="codeInfo" type="text" class="form-control" placeholder="请输入验证码" style="width: 220px;height: 45px;">'
  					);
  					$("#send2").val("确定修改");
  					$('#send2').attr("onclick","updateNewPhone()");
  				 }else{
  					
  					alert(result.message);
				}
			}
		})
	}
</script>
<!-- 账号密码模态框 -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabel">修改密码</h4>
      </div>
      <div class="modal-body">
        <form id="pwd">
          <div class="form-group" align="center">
          	<div style="padding-right:265px;">
          	 <label for="recipient-name" class="control-label">原密码:</label>
          	 </div>
            <input type="password" class="form-control" name="oldpwd" placeholder="输入旧密码"style="width: 320px;height: 45px;">
             <p></p>
             <div style="padding-right:265px;">
          	 <label for="recipient-name" class="control-label">新密码:</label>
          	</div>
          	 <input type="password" class="form-control" name="newpwd" placeholder="输入新密码" style="width: 320px;height: 45px;">
          	 <input type="password" class="form-control" placeholder="再次输入新密码" style="width: 320px;height: 45px;">
          	 <p style="color: #D7D2DC;font-size: 12px; font-weight:700">密码由6~16位数字，字母或符号组成，至少包含两种字符</p>
          	 <br>
          	 <input type="button" name="" class="btn btn-default" data-dismiss="modal" style="width: 100px;height: 40px;" value="取消">
          	 <input onclick="updatepwd()" type="button" name="" class="btn btn-primary" style="width: 100px;height: 40px; background-color: #2AD181; color: #fff;"value="确定">
          </div>
        </form>
      </div>
    </div>
  	</div>
</div>
<!-- 邮箱安全模态框 -->
<div class="modal fade" id="exampleModa2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe2">验证身份</h4>
      </div>
      <div class="modal-body">
        <form id="maliboxs2">
          <div class="form-group" align="center">
          		<p id="addcodetxt">
          			<span>点击发送短信认证按钮，将发送一条含有数字验证码的短信</span>
          			<br>
          			<span>至您的手机</span> <span style="color: #2AD181" id="mailboxid"></span>
          			<span>,用于验证身份</span>
          		</p>
          		<br>
          	 <input id="send" onclick="Authentication()" type="button" name="" class="btn btn_style btn_s" style="width: 200px;height: 40px; background-color: #2AD181; color: #fff;"value="发送信息">
          </div>
        </form>
      </div>
    </div>
  	</div>
</div>


<!-- 实名认证模态框 -->
<div class="modal fade" id="exampleModa3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe3">实名认证</h4>
        <p align="center">请确认是您本人，并填写真实信息</p>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group" align="center">
          	<div style="padding-right:265px;">
          	 <label for="recipient-name" class="control-label">真实姓名:</label>
          	 </div>
            <input type="text" class="form-control" id="recipient-name" placeholder="请输入真实姓名" style="width: 320px;height: 45px;">
             <p></p>
             <div style="padding-right:265px;">
          	 <label for="recipient-name" class="control-label">身份证号:</label>
          	</div>
          	 <input type="text" class="form-control" id="recipient-name" placeholder="请输入本人身份证号" style="width: 320px;height: 45px;">
          	 <br>
          	 <input type="button" name="" class="btn btn_style btn_s" style="width: 100px;height: 40px;" value="取消">
          	 <input type="button" name="" class="btn btn_style btn_s" style="width: 100px;height: 40px; background-color: #2AD181; color: #fff;"value="确定">
          </div>
        </form>
      </div>
    </div>
  	</div>
</div>
<!-- 个人信息模态框 -->
<div class="modal fade" id="exampleModa4" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe1">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe4">个人信息</h4>
      </div>
        <form id="myinfo"  enctype="multipart/form-data">
        <div class="modal-body">
          <div class="form-group" align="center">
          	<div style="position: relative;padding: 20px 0;">
          		<div style="margin: 10px 0">
          			<div style="font-weight: 700;display: inline-block;width: 70px;position: absolute;left: 0px;">
          				<font style="vertical-align: inherit;">
          					<font style="vertical-align: inherit;">头像</font>
          				</font>
          			</div>
          			<div style="font-weight: 700;display: inline-block;vertical-align: top;">
          				<img id="headimage" src="" style="height: 80px;width:100px;">
          				<div class="oploadImg" style="height: 37px;width: 117px;"  id="dload">
          				<img style="height: 14px;margin-bottom: 5px; margin-right: 5px;">
          						上传图片
          				</div>
          			
          			</div>
          			<input name="load" multiple="multiple" type="file" style="display:none"  accept="image/png,image/jpeg" id="load">
          		</div>
          		<p></p>
          		<div style="margin: 10px 0">
          		<div style="font-weight: 700;display: inline-block;width: 70px;position: absolute;left: 0px">
          				<font style="vertical-align: inherit;">
          					<font style="vertical-align: inherit;line-height: 2">
          						用户名
          					</font>
          				</font>
          			</div>
          			<div style="font-weight: 700;vertical-align: top;left: 0px;width: 245px; ">
          				<input id="myuserName" type="text" name="userName" class="form-control">
          				<span style="font-size: 12px;color: #7f7f7f;">2-1位字符，可使用字母、数字、汉字。</span>
          			</div>
          		</div>
          		<div style="width: 100%;height: 1px;background: rgba(0,0,0,.1); margin: 0 auto;"></div>
          		<br>
          		<div style="margin: 10px 0">
          		
          			
	          		<div style="font-weight: 700;display: inline-block;width: 70px;position: absolute;left: 0px">
	          				<font style="vertical-align: inherit;">
	          					<font style="vertical-align: inherit;line-height: 35px">
	          						性别
	          					</font>
	          				</font>
	          		</div>
          			<div style="font-weight: 700;vertical-align: top;left: 0px;width: 245px; ">
				           <select name="sex" class="form-control" id="sex">
                				<option>男</option>
                				<option>女</option>
          				  </select>
          			</div>
          			<p></p>
	          		<div style="font-weight: 700;display: inline-block;width: 70px;position: absolute;left: 0px">
	          				<font style="vertical-align: inherit;">
	          					<font style="vertical-align: inherit;line-height: 35px">
	          						生日
	          					</font>
	          				</font>
	          		</div>
          			<div style="font-weight: 700;vertical-align: top;left: 0px;width: 245px; ">
          				<input id="birthday" type="text" name="birthday" class="form-control">
          			</div>

          		</div>
          		<br><br>
          		<input type="button" name="" class="btn btn_style btn_s" style="width: 100px;height: 40px;" value="取消">
          	 	<input onclick="myinfo()" type="button" name="" class="btn btn_style btn_s" style="width: 100px;height: 40px; background-color: #2AD181; color: #fff;"value="确定">
          		</div>
          	</div>
          </div>
        </form>
      </div>
    </div>
  </div>
<div class="modal fade" id="exampleModa5" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">

  <div class="modal-dialog" role="document">    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe4">授权管理</h4>
      	<div class="modal-body">
      		<div class="form-group">
      			<p align="center">您的账号当前暂无授权登录第三应用</p>
      		</div>
      	</div>
      </div>
    </div>
  	</div>
</div>

<!-- 修改手机安全模态框 -->
<div class="modal fade" id="exampleModa6" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe1">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe6">验证身份</h4>
      </div>
      <div class="modal-body">
        <form id="maliboxs3">
          <div class="form-group" align="center">
          		<p id="phonecode">
          			<span>点击发送短信按钮，将发送一条含有数字验证码短信</span>
          			<br>
          			<span>至您的手机</span> <span style="color: #2AD181;" id="uphone"></span>
          			<span>,用于验证身份</span>
          		</p>
          		<br>
          	 <input id="send2" onclick="AuthenticationPhone()" type="button" name="" class="btn btn_style btn_s" style="width: 200px;height: 40px; background-color: #2AD181; color: #fff;"value="发送短信">
          </div>
        </form>
      </div>
    </div>
  	</div>
</div>
<!-- 设置邮箱安全模态框 -->
<div class="modal fade" id="exampleModa7" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  	<div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 450px; margin: auto;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" align="center" id="exampleModalLabe2">设置邮箱</h4>
      </div>
      <div class="modal-body">
        <form  id="maliboxs">
          <div class="form-group" align="center">
          		<p>
          			<span>点击发送邮件按钮，将发送一条含有数字验证码的邮件至您的邮箱，用于验证身份</span>
          			<input name="mailbox" type="text" class="form-control" placeholder="请输入正确的邮箱" style="width: 320px;height: 45px;">
          		</p>
          		<br>
          	 <input onclick="updatemailbox()" type="button" name="" class="btn btn_style btn_s" style="width: 200px;height: 40px; background-color: #2AD181; color: #fff;"value="发送邮件">
          </div>
        </form>
      </div>
    </div>
  	</div>
</div>
	<script type="text/javascript" src="me_files/jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="me_files/bootstrap.js"></script>
	<script type="text/javascript">
		$('#dload').on('click',function(){
			$('#load').click();
		})
	</script>
	<script type="text/javascript">
		var status =0;
		$('#sexclick').on('click',function(){
			var obj=document.getElementById('issex');
			if (status==0) {
				obj.style.cssText="display:block;position: relative;";
				status=1;
			}
			else{
				obj.style.cssText="display:none;position: relative;";
				status=0;
			}
		})
	</script>
	
	<script type="text/javascript">
		var status =0;
		$('#isture').on('click',function(){
			var obj=document.getElementById('list');
			if (status==0) {
				obj.style.cssText="display:block;";
				status=1;
			}
			else{
				obj.style.cssText="display:none;";
				status=0;
			}
		})
	</script>
	<script type="text/javascript">
		$('#exampleModal').on('show.bs.modal', function (event) {
  		var button = $(event.relatedTarget)
  		var recipient = button.data('whatever')
  		var modal = $(this)
		})
	</script>
	
<script>
    $('#load').change(function(){
      var $file = $(this);
      var fileObj = $file[0];
      var windowURL = window.URL || window.webkitURL;
      var dataURL;
      var $img = $("#headimage");
      if (fileObj && fileObj.files && fileObj.files[0]) {
          dataURL = windowURL.createObjectURL(fileObj.files[0]);
          $img.attr('src', dataURL);
      } 
    });
  </script>

</body>
</html>